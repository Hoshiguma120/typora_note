#            区块链



## 简介



## 比特币



[toc]





### BTC—NetWork

##### 应用层类型：

P2P  即所有的节点都是同等的节点

##### 运输层协议：

TCP -> 有利于穿过防火墙

##### 连接方式：

flooding（泛洪）->即计网中p2p的知识点，节点第一次收到某个消息时，将它传播给所有的==邻居==节点，同时标记这个消息自己已经收到了

(邻居节点是随机选取的，与地区因素无关)

离开方式：直接离开，过一段节点听不到通信就会自动删除你的通信

#### BTC设计原则：

简单，而不是高效









### 比特币的节点类型

各个节点是真正对等的，没有权重更高的节点，比特币分为==全节点==和==轻节点==，比特币大部分节点是轻节点，全节点由矿工维护。

#### 全节点

（3）检验交易正确性主要是指有无合法==签名==是不是==双花==

（6）监听工作主要为

1. 铸币：出块奖励是否为12.5BTC（假定当时奖励为12.5BTC）

2. 难度：target是否符合要求

3. 是否在延伸最长合法链

   （7）挖矿

   决定沿着哪条链挖？

   答：默认最长的那条链挖

   出现等长分叉选择哪一个分叉

   答：默认最先听到的那个

<img src="D:\笔记\区块链\images\全节点.png" alt="全节点" style="zoom:38%;" />

#### 轻节点

6.验证挖矿难度：同过轻节点保存的块头的信息可以验证发布的区块是否符合难度要求

<img src="D:\笔记\区块链\images\轻节点.png" alt="轻节点" style="zoom:38%;" />

#### 问题

- 问：矿工在沿着上个区块挖矿时，若已有另一个矿工成功挖出区块，那么之前的挖矿都要停止，然后重新对这个新发布的区块计算相匹配的哈希值，是否有些可惜？
- 答：不会，由于哈希值的memoryless，即无论挖一个新的区块还是原来的区块，其符合的哈希值概率都是一样的，付出的时间对结果没有影响。
- 问：挖出合法区块就一定能拿到奖励了吗?
- 答：不一定，有可能别人同时发布一个区块，最终你未能成为最为最长链，或者，你的区块上有一些你不知道的不合法交易，让你最终成为一个不合法区块
- 问：一笔交易在何时被写入一个区块中？是已经成为一个最长合法链，还是一个合法区块刚被挖出并公布时写入，若是后者，那么此区块未成为最长合法链，其中的交易怎么处理？
- 答：==……==
- 问：比特币如何保证安全性？
  1. 答：  	密码学上的保证：别人没有你的私钥，就无法伪造你的签名，无法把你账上的钱转走（前提是所有全节点大多数是友好的）
  2. 共识机制：即大部分节点是友好的情况下，就不会让一个坏节点接入区块中。



"cursive", Helvetica, Arial, 'Segoe UI Emoji', sans-serif

"Helvetica Neue", Helvetica, Arial, 'Segoe UI Emoji', sans-serif

### BTC--挖矿难度

#### 调整难度的意义：

维持出块频率不变，即不会因为链上的算力越来越多，导致出块频率越来越快!

出块太快的问题：虽然看起来交易写入需要等待的时间变少了，但由于网络延迟，所有节点收到一个区块的接入应该在几十秒左右而不是同一时间收到，有节点在同一时间收到多个区块而引起多个分叉的事情会很常见，有些坏节点发起攻击就很容易：比如囤积更多的区块一次性接入之前的区块从而构成一个最长的合法链

#### 比特币采取的哈希算法：SHA--256

#### 难度：next_difficultly=pre_difficulty*target

#### 难度调整（target）：

系统规定每出2016个区块就调整一次难度即2016*  ==10== /(60*24) =14天 （两周）（10指的是比特币每十分钟出一个区块）

next_target=pre_target*(actual time/expected time) 即由实际时间除以理想出块时间的比值决定降低还是提高难度，为了防止意外情况，actual time最长也不能大于expected time 的四倍（即8周），最短也不能小于其四倍（即半周）

#### target思考：

由于target是一段开源的代码，所以有恶意的节点可以调整他的难度使得出块速度增加，但是入链时仍要经过合法性检验，好的节点就不会接受它.

#### target（目标阈值）和挖矿难度（diffictly）之间的关系：

成反比





### 挖矿：从cpu到ASIC再到矿场（矿池）

###### 设备趋于专业化：

1. cpu 即普通的电脑挖矿 ==缺点==：很多内存，磁盘用不到，性价比不高。
2. gpu：通用数字计算，相比于cpu更划算，但是计算Hash只需要计算整数，Gpu里用于浮点数计算的部件也浪费掉了
3. ASIC: 定制的专用的芯片，只用来挖矿 ==缺点==;定制周期长 ===每种ASIC芯片只能用于一个币种==：由于每个加密货币都有一个特定的mining puzzle， （有的新货币刚发行时，也会有些跟以前某个出名的货币mining puzzle 相绑定 让更多的矿工愿意挖这个币）

###### ==矛盾==：

比特币是为了维持一个去中心化的状态，但随着挖矿设备趋于专业化，更多矿工为了争求算力，要向芯片厂商定制研发ASIC芯片，有时候芯片厂商研发出芯片并不给矿工而是先用来挖矿，这显然也中心化的理念相悖，为了防止这种情况，更多的加密货币将ming puzzle设置为 alternative(可替代的) 进而改变 resitance 抗制挖矿设备趋于专业化，让通用的计算机也能参与挖矿过程

###### 矿场和矿池:

==区别==：矿场是矿机等挖矿硬件设备集合作业的场所，在地理位置上是在同一位置

矿池可以是若干矿机的集合，也可以是若干矿机算力的集合，还可以理解为对外开放的团队开采服务器集合。矿池一般是以网站或APP应用形式呈现的。（矿机之间通过特定的网络协议交流，共享算力)

==出现原因==：由于单个矿工算力有限，很长一段时间也挖不到区块很常见，负担太大，所以有多个矿工组成矿池或者矿场，区块奖励共享，由原来不稳定的大额收入换来了稳定的小额收入

矿池组织可以组织矿工挖矿，并通过 share nonce（和ming puzzle差不多的哈希值）来判定贡献的算力

（share nonce只是相似的哈希值，即在标准哈希值一定范围的值，矿池组织拿到share nonce并不会获得出块奖励，设置其的意义在于能估计一个矿工贡献的算力多少，从而给予相应的奖励）

==危害==：当一个矿池或者一个机构掌握了区块链中50%以上的算力，就有发动攻击的条件并且可能成功（分叉攻击）







## 以太坊





